{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///D:/IIIT/Kochi-Metro-document/frontend/app/documents/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { createContext, useContext, useState, useEffect, useMemo } from 'react';\r\nimport { useSearchParams } from 'next/navigation';\r\nimport {\r\n    FileText, Settings, LogOut, Search, ChevronDown, Loader2, Upload, X, ArrowUp, ArrowDown, FileImage,\r\n    LayoutDashboard, FolderKanban, BarChart2, CheckSquare, Globe, ListChecks, DollarSign\r\n} from 'lucide-react';\r\nimport Link from 'next/link';\r\n\r\n// Base URL for backend API with safe fallback for client-side usage\r\nconst API_BASE = (process.env.NEXT_PUBLIC_API_BASE_URL ?? 'http://127.0.0.1:8000').replace(/\\/+$/, '');\r\n\r\n// --- (1) UPDATE THE DOCUMENT TYPE to include the new ML-generated fields ---\r\ntype Document = {\r\n    id: string; // The UUID from the backend is a string\r\n    title: string;\r\n    department: string;\r\n    upload_date: string;\r\n    file_path: string; // The public URL from Supabase\r\n    status: string;\r\n    summary?: string;\r\n    deadlines?: string[];\r\n    financial_terms?: string[];\r\n};\r\n\r\n// We need a type for the conversation history\r\ntype QnaPair = {\r\n    id: string;\r\n    question_text: string;\r\n    answer_text: string | null;\r\n    asked_at: string;\r\n}\r\n\r\n// --- Reusable Components ---\r\n\r\n// This defines the \"shape\" of the context and creates a hook to use it.\r\nconst DocumentsPageContext = createContext<{ setShowQnaModalForDoc: (doc: Document | null) => void }>({\r\n    setShowQnaModalForDoc: () => {}, // Default empty function\r\n});\r\nconst useDocumentsPageContext = () => useContext(DocumentsPageContext);\r\n\r\nconst NavLink = ({ href, icon, children, isActive }: { href: string; icon: React.ReactNode; children: React.ReactNode; isActive: boolean; }) => (\r\n    <Link href={href} className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors duration-200 ${isActive ? 'bg-blue-600 text-white shadow-lg' : 'text-gray-400 hover:bg-gray-800 hover:text-white'}`}>\r\n        {icon}\r\n        <span className=\"font-medium\">{children}</span>\r\n    </Link>\r\n);\r\n\r\n// --- (4) ENHANCE THE MODAL to display the new ML data ---\r\nconst DocumentViewerModal = ({ doc, onClose, onOpenQna }: { doc: Document; onClose: () => void; onOpenQna: () => void; }) => {\r\n    const [activeTab, setActiveTab] = useState<'summary' | 'original'>('summary');\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 animate-fade-in\">\r\n            <div className=\"bg-gray-900 w-full h-full md:w-11/12 md:h-5/6 md:rounded-lg shadow-2xl flex flex-col\">\r\n                <header className=\"flex justify-between items-center p-4 border-b border-gray-700 flex-shrink-0\">\r\n                    <div>\r\n                        <h3 className=\"text-xl font-bold text-white\">{doc.title}</h3>\r\n                        <p className=\"text-sm text-gray-400\">{doc.department} &bull; {doc.upload_date}</p>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"bg-gray-800 p-1 rounded-lg flex gap-1\">\r\n                            <button\r\n                                onClick={() => setActiveTab('summary')}\r\n                                className={`px-3 py-1 text-sm rounded-md ${activeTab === 'summary' ? 'bg-blue-600 text-white' : 'text-gray-300 hover:bg-gray-700'}`}\r\n                            >\r\n                                Summary & Details\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setActiveTab('original')}\r\n                                className={`px-3 py-1 text-sm rounded-md ${activeTab === 'original' ? 'bg-blue-600 text-white' : 'text-gray-300 hover:bg-gray-700'}`}\r\n                            >\r\n                                Original Document\r\n                            </button>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={onOpenQna}\r\n                            className=\"bg-green-600 text-white px-4 py-1 text-sm rounded-md hover:bg-green-700 font-semibold\"\r\n                        >\r\n                            Q&A on this Doc\r\n                        </button>\r\n\r\n                        <button onClick={onClose} className=\"text-gray-400 hover:text-white bg-gray-800 p-2 rounded-full\"><X size={20} /></button>\r\n                    </div>\r\n                </header>\r\n                <main className=\"flex-1 overflow-y-auto p-6 text-gray-300\">\r\n                    {activeTab === 'summary' && (\r\n                        <div className=\"space-y-8\">\r\n                            <div>\r\n                                <h4 className=\"text-lg font-semibold text-white mb-3 flex items-center gap-2\"><FileText size={20} /> AI Generated Summary</h4>\r\n                                <p className=\"prose prose-invert max-w-none\">{doc.summary || 'No summary available.'}</p>\r\n                            </div>\r\n\r\n                            {(doc.deadlines && doc.deadlines.length > 0) && (\r\n                                <div>\r\n                                    <h4 className=\"text-lg font-semibold text-white mb-3 flex items-center gap-2\"><ListChecks size={20} /> Deadlines / Key Dates</h4>\r\n                                    <ul className=\"list-disc pl-5 space-y-1\">\r\n                                        {doc.deadlines.map((deadline, index) => <li key={index}>{deadline}</li>)}\r\n                                    </ul>\r\n                                </div>\r\n                            )}\r\n\r\n                            {(doc.financial_terms && doc.financial_terms.length > 0) && (\r\n                                <div>\r\n                                    <h4 className=\"text-lg font-semibold text-white mb-3 flex items-center gap-2\"><DollarSign size={20} /> Financial Terms</h4>\r\n                                     <ul className=\"list-disc pl-5 space-y-1\">\r\n                                        {doc.financial_terms.map((term, index) => <li key={index}>{term}</li>)}\r\n                                    </ul>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                    {activeTab === 'original' && (\r\n                        doc.file_path ? (\r\n                            <iframe src={doc.file_path} className=\"w-full h-full bg-white rounded-md\" title={doc.title}></iframe>\r\n                        ) : (\r\n                            <div className=\"flex flex-col items-center justify-center h-full text-gray-500\">\r\n                                <FileImage size={64} />\r\n                                <p className=\"mt-4\">No original document preview available.</p>\r\n                            </div>\r\n                        )\r\n                    )}\r\n                </main>\r\n            </div>\r\n        </div>\r\n    )\r\n};\r\n\r\n// --- ADD THIS NEW Q&A MODAL COMPONENT ---\r\nconst QnaModal = ({ doc, onClose }: { doc: Document; onClose: () => void; }) => {\r\n    const [conversation, setConversation] = useState<QnaPair[]>([]);\r\n    const [newQuestion, setNewQuestion] = useState('');\r\n    const [isLoading, setIsLoading] = useState(true); // Start loading true to fetch history\r\n\r\n    const suggestedQuestions = [\r\n        `What is the main summary of this document?`,\r\n        `Are there any important deadlines mentioned?`,\r\n        `What are the key financial terms in this document?`,\r\n    ];\r\n\r\n    // Function to fetch the conversation history\r\n    const fetchConversation = async () => {\r\n        try {\r\n            const response = await fetch(`${API_BASE}/documents/${doc.id}/questions`);\r\n            if (!response.ok) throw new Error(\"Failed to fetch history.\");\r\n            const data = await response.json();\r\n            setConversation(data);\r\n        } catch (err) {\r\n            console.error(err);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // Fetch the history when the modal first opens\r\n    useEffect(() => {\r\n        fetchConversation();\r\n    }, []);\r\n\r\n    const handleAskQuestion = async (questionText: string) => {\r\n        if (!questionText.trim()) return;\r\n\r\n        const newQnaEntry: QnaPair = {\r\n            id: `temp-${Date.now()}`, // A temporary ID for the React key\r\n            question_text: questionText,\r\n            answer_text: null, // It starts with \"Awaiting answer...\"\r\n            asked_at: new Date().toISOString(),\r\n        };\r\n        setConversation(prev => [...prev, newQnaEntry]);\r\n        setNewQuestion(''); // Clear the input box immediately\r\n        setIsLoading(true);\r\n\r\n        try {\r\n            const response = await fetch(`${API_BASE}/documents/${doc.id}/questions`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ question_text: questionText }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                throw new Error('Failed to submit question.');\r\n            }\r\n\r\n            // After successfully asking, refresh the conversation history\r\n            await fetchConversation();\r\n\r\n        } catch (err: any) {\r\n            alert(`Error: ${err.message}`);\r\n            // Optionally, remove the optimistic update on error\r\n            setConversation(prev => prev.filter(q => q.id !== newQnaEntry.id));\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 animate-fade-in\">\r\n            <div className=\"bg-gray-800 w-full max-w-2xl h-5/6 rounded-lg shadow-2xl flex flex-col p-6\">\r\n                <header className=\"flex justify-between items-center mb-4 flex-shrink-0\">\r\n                    <h3 className=\"text-xl font-bold text-white\">Q&A on \"{doc.title}\"</h3>\r\n                    <button onClick={onClose} className=\"text-gray-400 hover:text-white\"><X size={24} /></button>\r\n                </header>\r\n\r\n                <main className=\"flex-1 overflow-y-auto pr-2 space-y-4\">\r\n                    {isLoading && <div className=\"text-center text-gray-400\">Loading history...</div>}\r\n                    {conversation.map(qna => (\r\n                        <div key={qna.id}>\r\n                            <p className=\"font-semibold text-blue-300\">You asked:</p>\r\n                            <p className=\"bg-gray-700 p-2 rounded-md mb-2\">{qna.question_text}</p>\r\n                            <p className=\"font-semibold text-green-300\">Answer:</p>\r\n                            <p className=\"bg-gray-900 p-2 rounded-md\">\r\n                                {qna.answer_text ? qna.answer_text : <span className=\"text-gray-400 italic\">Awaiting answer from AI...</span>}\r\n                            </p>\r\n                        </div>\r\n                    ))}\r\n                </main>\r\n\r\n                <footer className=\"mt-4 flex-shrink-0\">\r\n                    <div className=\"flex gap-2 mb-3\">\r\n                        {suggestedQuestions.map((q, i) => (\r\n                            <button key={i} onClick={() => handleAskQuestion(q)} className=\"text-sm bg-gray-700 hover:bg-gray-600 text-gray-300 px-3 py-1 rounded-full text-left\">\r\n                                {q}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                    <form onSubmit={(e) => { e.preventDefault(); handleAskQuestion(newQuestion); }} className=\"flex gap-2\">\r\n                        <input\r\n                            type=\"text\"\r\n                            value={newQuestion}\r\n                            onChange={(e) => setNewQuestion(e.target.value)}\r\n                            placeholder=\"Type your question here...\"\r\n                            className=\"flex-grow bg-gray-700 text-white rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                        />\r\n                        <button type=\"submit\" disabled={isLoading} className=\"bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-md disabled:bg-gray-500\">\r\n                            Ask\r\n                        </button>\r\n                    </form>\r\n                </footer>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n// --- Main Documents Page Component ---\r\nexport default function DocumentsPage() {\r\n    const searchParams = useSearchParams();\r\n\r\n    const [documents, setDocuments] = useState<Document[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    // Sort key is now a string to match the updated Document type\r\n    const [sortConfig, setSortConfig] = useState<{ key: keyof Document; direction: 'asc' | 'desc' }>({ key: 'upload_date', direction: 'desc' });\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [showUploadModal, setShowUploadModal] = useState(false);\r\n    const [selectedDoc, setSelectedDoc] = useState<Document | null>(null);\r\n\r\n    const [deptSlug, setDeptSlug] = useState<string>('operations');\r\n    const [isAdmin, setIsAdmin] = useState(false);\r\n\r\n    // const [selectedDoc, setSelectedDoc] = useState<Document | null>(null);\r\n    const [showQnaModalForDoc, setShowQnaModalForDoc] = useState<Document | null>(null);\r\n\r\n    useEffect(() => {\r\n        const init = async () => {\r\n            setIsLoading(true);\r\n            const urlDept = (searchParams.get('dept') || '').toLowerCase();\r\n            let storedUser: any = null;\r\n            try {\r\n                storedUser = typeof window !== 'undefined' ? JSON.parse(localStorage.getItem('kmrl_user') || 'null') : null;\r\n            } catch { }\r\n            const admin = storedUser?.isAdmin || urlDept === 'admin';\r\n            setIsAdmin(admin);\r\n            setDeptSlug(admin ? 'admin' : (storedUser?.deptSlug || urlDept || 'operations'));\r\n\r\n            try {\r\n                let fetchUrl = '';\r\n                if (admin) {\r\n                    // fetchUrl = `${API_BASE}/documents/?skip=0&limit=100`;\r\n                    fetchUrl = `${API_BASE}/documents/`;\r\n                } else {\r\n                    const deptToFetch = storedUser?.department || 'Operations';\r\n                    fetchUrl = `${API_BASE}/documents/${encodeURIComponent(deptToFetch)}`;\r\n                }\r\n\r\n                const response = await fetch(fetchUrl);\r\n                if (!response.ok) {\r\n                    throw new Error('Failed to fetch documents');\r\n                }\r\n                const backendDocs = await response.json();\r\n\r\n                // --- (2) FIX THE DATA MAPPING: Use the real data from the backend ---\r\n                const mappedDocs: Document[] = (backendDocs || []).map((d: any) => ({\r\n                    id: d.id,\r\n                    title: d.title,\r\n                    department: d.department,\r\n                    upload_date: d.upload_date ? new Date(d.upload_date).toISOString().slice(0, 10) : 'N/A',\r\n                    file_path: d.file_path,\r\n                    status: d.status,\r\n                    summary: d.summary,\r\n                    deadlines: d.deadlines || [],\r\n                    financial_terms: d.financial_terms || [],\r\n                }));\r\n                // --- END OF FIX ---\r\n\r\n                setDocuments(mappedDocs);\r\n\r\n            } catch (err) {\r\n                console.error(err);\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n        init();\r\n    }, [searchParams]);\r\n\r\n    // This logic can be simplified as filtering is done on the frontend for now\r\n    const sortedAndFilteredDocuments = useMemo(() => {\r\n        let sortedDocs = [...documents];\r\n        if (sortConfig.key) {\r\n            sortedDocs.sort((a, b) => {\r\n                if (a[sortConfig.key]! < b[sortConfig.key]!) return sortConfig.direction === 'asc' ? -1 : 1;\r\n                if (a[sortConfig.key]! > b[sortConfig.key]!) return sortConfig.direction === 'asc' ? 1 : -1;\r\n                return 0;\r\n            });\r\n        }\r\n        if (searchTerm) {\r\n            return sortedDocs.filter(doc => doc.title.toLowerCase().includes(searchTerm.toLowerCase()));\r\n        }\r\n        return sortedDocs;\r\n    }, [documents, sortConfig, searchTerm]);\r\n\r\n    const requestSort = (key: keyof Document) => {\r\n        let direction: 'asc' | 'desc' = 'asc';\r\n        if (sortConfig.key === key && sortConfig.direction === 'asc') {\r\n            direction = 'desc';\r\n        }\r\n        setSortConfig({ key, direction });\r\n    };\r\n\r\n    if (isLoading) {\r\n        return <div className=\"flex min-h-screen bg-gray-900 items-center justify-center\"><Loader2 className=\"animate-spin text-blue-500\" size={48} /></div>;\r\n    }\r\n\r\n    return (\r\n        <DocumentsPageContext.Provider value={{ setShowQnaModalForDoc }}>\r\n\r\n        <div className=\"flex min-h-screen bg-gray-900 text-gray-300\">\r\n            {/*{selectedDoc && <DocumentViewerModal doc={selectedDoc} onClose={() => setSelectedDoc(null)} />}*/}\r\n            {selectedDoc && (\r\n                <DocumentViewerModal\r\n                    doc={selectedDoc}\r\n                    onClose={() => setSelectedDoc(null)}\r\n                    // This new prop defines what happens when the Q&A button is clicked\r\n                    onOpenQna={() => {\r\n                        setShowQnaModalForDoc(selectedDoc); // Open the QnA modal with the current doc\r\n                        setSelectedDoc(null);             // Close this viewer modal\r\n                    }}\r\n                />\r\n            )}\r\n            {showQnaModalForDoc && <QnaModal doc={showQnaModalForDoc} onClose={() => setShowQnaModalForDoc(null)} />}\r\n\r\n            <aside className=\"w-64 bg-gray-950 p-6 flex-shrink-0 flex flex-col\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-white mb-8\">Docu Sphere</h1>\r\n                    <nav className=\"flex flex-col gap-4\">\r\n                        <NavLink href=\"/dashboard\" icon={<LayoutDashboard size={20} />} isActive={false}>Dashboard</NavLink>\r\n                        <NavLink href=\"/documents\" icon={<FolderKanban size={20} />} isActive={true}>Documents</NavLink>\r\n                        <NavLink href=\"#\" icon={<BarChart2 size={20} />} isActive={false}>Reports</NavLink>\r\n                        <NavLink href=\"#\" icon={<CheckSquare size={20} />} isActive={false}>Approvals</NavLink>\r\n                    </nav>\r\n                </div>\r\n                <div className=\"mt-auto\">\r\n                    <NavLink href=\"#\" icon={<Settings size={20} />} isActive={false}>Settings</NavLink>\r\n                    <NavLink href=\"/\" icon={<LogOut size={20} />} isActive={false}>Logout</NavLink>\r\n                </div>\r\n            </aside>\r\n\r\n            <main className=\"flex-1 p-8 overflow-y-auto\">\r\n                {/*<>{selectedDoc && <DocumentViewerModal doc={selectedDoc} onClose={() => setSelectedDoc(null)} />}*/}\r\n\r\n                {/*/!* --- ADD THE NEW QNA MODAL RIGHT HERE --- *!/*/}\r\n                {/*{sho</>wQnaModalForDoc && <QnaModal doc={showQnaModalForDoc} onClose={() => setShowQnaModalForDoc(null)} />}*/}\r\n\r\n                {showUploadModal && (\r\n                    <UploadModal\r\n                        currentDept={isAdmin ? 'Admin' : deptSlug.charAt(0).toUpperCase() + deptSlug.slice(1)}\r\n                        canChooseDept={isAdmin}\r\n                        onClose={() => setShowUploadModal(false)}\r\n                        // --- (3) IMPROVE THE onUpload HANDLER ---\r\n                        onUpload={(newlyUploadedDocFromServer) => {\r\n                            // Map the single new document from the backend to our frontend type\r\n                            const mappedDoc: Document = {\r\n                                id: newlyUploadedDocFromServer.id,\r\n                                title: newlyUploadedDocFromServer.title,\r\n                                department: newlyUploadedDocFromServer.department,\r\n                                upload_date: newlyUploadedDocFromServer.upload_date ? new Date(newlyUploadedDocFromServer.upload_date).toISOString().slice(0, 10) : 'N/A',\r\n                                file_path: newlyUploadedDocFromServer.file_path,\r\n                                status: newlyUploadedDocFromServer.status,\r\n                                summary: newlyUploadedDocFromServer.summary,\r\n                                deadlines: newlyUploadedDocFromServer.deadlines || [],\r\n                                financial_terms: newlyUploadedDocFromServer.financial_terms || [],\r\n                            };\r\n                            // Add the new, confirmed document to the top of the list\r\n                            setDocuments(prev => [mappedDoc, ...prev]);\r\n                        }}\r\n                    />\r\n                )}\r\n\r\n                <header className=\"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4\">\r\n                    <div>\r\n                        <h2 className=\"text-3xl font-bold text-white\">{isAdmin ? 'All Documents' : `${deptSlug.charAt(0).toUpperCase() + deptSlug.slice(1)} Documents`}</h2>\r\n                        <p className=\"text-gray-400\">Browse, search, and manage files.</p>\r\n                    </div>\r\n                    <button onClick={() => setShowUploadModal(true)} className=\"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md flex items-center gap-2\">\r\n                        <Upload size={20} /> Upload Document\r\n                    </button>\r\n                </header>\r\n\r\n                <div className=\"flex items-center gap-4 mb-6 bg-gray-950 p-4 rounded-lg\">\r\n                    <div className=\"relative flex-grow\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500\" size={20} />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search by title...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            className=\"bg-gray-800 border-gray-700 w-full text-white rounded-md pl-10 pr-4 py-2 focus:outline-none focus:border-blue-500\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <span className=\"text-gray-400 text-sm\">Sort by:</span>\r\n                        <button onClick={() => requestSort('upload_date')} className=\"flex items-center gap-1 text-white hover:text-blue-400\">\r\n                            Date {sortConfig.key === 'upload_date' && (sortConfig.direction === 'asc' ? <ArrowUp size={16} /> : <ArrowDown size={16} />)}\r\n                        </button>\r\n                        <button onClick={() => requestSort('title')} className=\"flex items-center gap-1 text-white hover:text-blue-400\">\r\n                            Title {sortConfig.key === 'title' && (sortConfig.direction === 'asc' ? <ArrowUp size={16} /> : <ArrowDown size={16} />)}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                <section>\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6\">\r\n                        {sortedAndFilteredDocuments.map(doc => (\r\n                            <DocumentCard\r\n                                key={doc.id}\r\n                                doc={doc}\r\n                                onClick={() => setSelectedDoc(doc)}\r\n                            />\r\n                        ))}\r\n                    </div>\r\n                    {sortedAndFilteredDocuments.length === 0 && (\r\n                        <div className=\"text-center py-16 bg-gray-800 rounded-md\">\r\n                            <p className=\"text-gray-400\">No documents found.</p>\r\n                        </div>\r\n                    )}\r\n                </section>\r\n            </main>\r\n        </div>\r\n        </DocumentsPageContext.Provider>\r\n\r\n    );\r\n}\r\n\r\n\r\nconst DocumentCard = ({ doc, onClick }: { doc: Document; onClick: () => void; }) => {\r\n    // This hook correctly gets the function to open the Q&A modal from the parent page\r\n    const { setShowQnaModalForDoc } = useDocumentsPageContext();\r\n\r\n    return (\r\n        // This is the main container for styling\r\n        <div className=\"bg-gray-800 p-4 rounded-lg shadow-lg flex flex-col justify-between h-48 group hover:bg-gray-700 transition-colors\">\r\n\r\n            {/* Part 1: Main Clickable Area for Document Viewer */}\r\n            {/* This div takes up most of the space and handles the original 'onClick' to view the PDF */}\r\n            <div onClick={onClick} className=\"flex-grow cursor-pointer\">\r\n                <FileText className=\"text-blue-400\" size={32} />\r\n                <h4 className=\"font-bold text-white mt-3 truncate group-hover:text-blue-300\">{doc.title}</h4>\r\n                <p className=\"text-sm text-gray-400\">{doc.department}</p>\r\n            </div>\r\n\r\n            {/* Part 2: Footer with Status and the new Q&A Button */}\r\n            <div className=\"flex-shrink-0 pt-2\">\r\n                <p className=\"text-xs text-gray-500\">Status: {doc.status}</p>\r\n\r\n                {/* This is the new button for the Q&A feature */}\r\n                <button\r\n                    onClick={(e) => {\r\n                        // This stops the click from also triggering the main card's onClick\r\n                        e.stopPropagation();\r\n                        // This calls the function from our context to open the Q&A modal\r\n                        setShowQnaModalForDoc(doc);\r\n                    }}\r\n                    className=\"mt-2 w-full text-center bg-green-600 text-white text-xs py-1 rounded hover:bg-green-700 transition-colors font-semibold\"\r\n                >\r\n                    Q&A\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n// UploadModal remains mostly the same, no major changes needed here\r\nconst UploadModal = ({ onClose, onUpload, currentDept, canChooseDept }: { onClose: () => void; onUpload: (data: any) => void; currentDept: string; canChooseDept: boolean; }) => {\r\n    const [title, setTitle] = useState('');\r\n    const [file, setFile] = useState<File | null>(null);\r\n    const [dept, setDept] = useState(currentDept);\r\n    const [isUploading, setIsUploading] = useState(false);\r\n\r\n    const submit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!title.trim() || !file) {\r\n            alert('Title and file are required.');\r\n            return;\r\n        }\r\n        setIsUploading(true);\r\n        let user: any = null;\r\n        try {\r\n            user = typeof window !== 'undefined' ? JSON.parse(localStorage.getItem('kmrl_user') || 'null') : null;\r\n        } catch { }\r\n\r\n        if (!user) {\r\n            alert('Could not find user info. Please log in again.');\r\n            setIsUploading(false);\r\n            return;\r\n        }\r\n\r\n        const formData = new FormData();\r\n        formData.append('title', title.trim());\r\n        formData.append('department', dept);\r\n        formData.append('user_id', user.userId);\r\n        formData.append('file', file);\r\n\r\n        try {\r\n            const response = await fetch(`${API_BASE}/documents/upload`, {\r\n                method: 'POST',\r\n                body: formData,\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errorData = await response.json();\r\n                throw new Error(errorData.detail || 'Upload failed');\r\n            }\r\n\r\n            const result = await response.json();\r\n            onUpload(result.document_info);\r\n            onClose();\r\n\r\n        } catch (err: any) {\r\n            alert(`Error: ${err.message}`);\r\n            console.error(err);\r\n        } finally {\r\n            setIsUploading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50\">\r\n            <div className=\"bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-lg relative\">\r\n                <button onClick={onClose} className=\"absolute top-4 right-4 text-gray-400 hover:text-white\"><X size={24} /></button>\r\n                <h3 className=\"text-2xl font-bold text-white mb-6\">Upload New Document</h3>\r\n                <form className=\"space-y-4\" onSubmit={submit}>\r\n                    {/* Form fields remain the same */}\r\n                    <div>\r\n                        <label className=\"text-sm font-bold text-gray-400 block mb-2\">Document Title</label>\r\n                        <input value={title} onChange={(e) => setTitle(e.target.value)} type=\"text\" placeholder=\"e.g., Q4 Financial Projections\" className=\"w-full bg-gray-700 text-white rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-blue-500\" />\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-sm font-bold text-gray-400 block mb-2\">Department</label>\r\n                        {canChooseDept ? (\r\n                            <select value={dept} onChange={(e) => setDept(e.target.value)} className=\"w-full bg-gray-700 text-white rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-blue-500\">\r\n                                <option value=\"Finance\">Finance</option>\r\n                                <option value=\"Operations\">Operations</option>\r\n                                <option value=\"Engineering\">Engineering</option>\r\n                                <option value=\"Maintenance\">Maintenance</option>\r\n                                <option value=\"HR\">HR</option>\r\n                            </select>\r\n                        ) : (\r\n                            <input readOnly value={dept} className=\"w-full bg-gray-700 text-white rounded-md p-3\" />\r\n                        )}\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"text-sm font-bold text-gray-400 block mb-2\">Document File</label>\r\n                        <div className=\"border-2 border-dashed border-gray-600 rounded-md p-6 text-center relative\">\r\n                            <Upload size={40} className=\"mx-auto text-gray-500 mb-2\" />\r\n                            <p className=\"text-gray-400\">{file ? file.name : 'Drag & drop files here or click to browse'}</p>\r\n                            <input onChange={(e) => setFile(e.target.files?.[0] || null)} type=\"file\" className=\"opacity-0 absolute inset-0 w-full h-full cursor-pointer\" />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"pt-4\">\r\n                        <button type=\"submit\" disabled={isUploading} className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-md transition-colors disabled:bg-gray-500 disabled:cursor-not-allowed flex items-center justify-center gap-2\">\r\n                            {isUploading && <Loader2 className=\"animate-spin\" size={20} />}\r\n                            {isUploading ? 'Uploading...' : 'Upload Document'}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n};"],"names":[],"mappings":"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","debugId":null}}]
}