{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/IIIT/Kochi-Metro-document/frontend/app/login/page.tsx"],"sourcesContent":["'use client'; // This must be a client component to handle user interaction\r\n\r\nimport { useState, FormEvent, Suspense } from 'react';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport ReCAPTCHA from 'react-google-recaptcha';\r\nimport { ArrowLeft } from 'lucide-react';\r\n\r\n// Base URL for backend API with safe fallback for client-side usage\r\nconst API_BASE = (process.env.NEXT_PUBLIC_API_BASE_URL ?? 'http://127.0.0.1:8000').replace(/\\/+$/,'');\r\n\r\n// Utility: map ID prefix to department slug and label\r\nconst prefixToDept = (id: string) => {\r\n    const u = id.toUpperCase();\r\n    if (u.startsWith('ADMIN')) return { slug: 'admin', label: 'Admin' };\r\n    if (u.startsWith('OPS')) return { slug: 'operations', label: 'Operations' };\r\n    if (u.startsWith('ENG')) return { slug: 'engineering', label: 'Engineering' };\r\n    if (u.startsWith('MNT')) return { slug: 'maintenance', label: 'Maintenance' };\r\n    if (u.startsWith('FIN')) return { slug: 'finance', label: 'Finance' };\r\n    if (u.startsWith('HR')) return { slug: 'hr', label: 'HR' };\r\n    return { slug: 'operations', label: 'Operations' }; // default\r\n};\r\n\r\n// A separate component to handle Suspense for useSearchParams\r\nconst LoginContent = () => {\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n    const role = searchParams.get('role') || 'department'; // Default to department\r\n\r\n    const [userId, setUserId] = useState('');\r\n    const [name, setName] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [recaptchaToken, setRecaptchaToken] = useState<string | null>(null);\r\n    const [error, setError] = useState('');\r\n\r\n    const handleLogin = async (e: FormEvent) => {\r\n        e.preventDefault();\r\n        setError('');\r\n\r\n        if (!userId || !password) {\r\n            setError('User ID and Password are required.');\r\n            return;\r\n        }\r\n        if (!recaptchaToken) {\r\n            setError('Please complete the reCAPTCHA challenge.');\r\n            return;\r\n        }\r\n\r\n        const departmentInfo = prefixToDept(userId);\r\n        const department = departmentInfo.label; // e.g., \"Engineering\"\r\n\r\n        const skip = parseInt('0', 10);\r\n        const limit = parseInt('100', 10);\r\n\r\n        console.log(\"Clean Department:\", department);\r\n        console.log(\"Clean Skip:\", skip);\r\n        console.log(\"Clean Limit:\", limit);\r\n\r\n        try {\r\n            // const urlToFetch = `${API_BASE}/users/${encodeURIComponent(userId)}`;\r\n            const urlToFetch = `${API_BASE}/documents/${encodeURIComponent(department)}?skip=${skip}&limit=${limit}`;\r\n\r\n            // ADD THIS LINE\r\n            console.log(\"Attempting to fetch from URL:\", urlToFetch);\r\n\r\n            // let response = await fetch(urlToFetch, { method: 'GET' });\r\n\r\n            const response = await fetch(urlToFetch);\r\n\r\n            if (!response.ok) {\r\n                setError(`Failed to fetch documents for department: ${department}`);\r\n                return;\r\n            }\r\n\r\n            console.log(\"Connection successful! Simulating login.\");\r\n\r\n            const isAdmin = departmentInfo.slug === 'admin';\r\n\r\n            // Mock auth: Save user context locally\r\n            const user = {\r\n                name: name || userId,\r\n                userId: userId,\r\n                department: department,\r\n                deptSlug: departmentInfo.slug,\r\n                isAdmin,\r\n            };\r\n\r\n            if (typeof window !== 'undefined') {\r\n                localStorage.setItem('kmrl_user', JSON.stringify(user));\r\n            }\r\n\r\n            // Redirect rules\r\n            if (isAdmin) {\r\n                router.push('/admin');\r\n            } else {\r\n                router.push(`/dashboard?dept=${departmentInfo.slug}`);\r\n            }\r\n\r\n        } catch (err) {\r\n            setError('Failed to connect to the backend. Is the server running and CORS configured?');\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    const siteKey = process.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY;\r\n    if (!siteKey) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-screen bg-gray-900 text-white\">\r\n                <p className=\"text-red-400 text-center\">reCAPTCHA Site Key is not configured.</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex items-center justify-center min-h-screen bg-gray-900\">\r\n            <div className=\"w-full max-w-md p-8 space-y-8 bg-gray-950 rounded-2xl shadow-2xl\">\r\n                <div className=\"text-center\">\r\n                    <Link href=\"/\" className=\"text-3xl font-extrabold text-white\">\r\n                        Docu <span className=\"text-blue-500\">Sphere</span>\r\n                    </Link>\r\n                    <h2 className=\"mt-4 text-2xl font-bold text-gray-300 capitalize\">\r\n                        {role} Portal Access\r\n                    </h2>\r\n                </div>\r\n\r\n                <form className=\"space-y-6\" onSubmit={handleLogin}>\r\n                    <div>\r\n                        <label htmlFor=\"userId\" className=\"text-sm font-bold text-gray-400\">\r\n                            User ID (e.g., FIN001, ENG002, ADMIN001)\r\n                        </label>\r\n                        <input\r\n                            id=\"userId\"\r\n                            name=\"userId\"\r\n                            type=\"text\"\r\n                            required\r\n                            value={userId}\r\n                            onChange={(e) => setUserId(e.target.value)}\r\n                            className=\"w-full px-4 py-3 mt-2 text-gray-100 bg-gray-800 border border-gray-700 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none\"\r\n                            placeholder=\"Enter your User ID\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label htmlFor=\"name\" className=\"text-sm font-bold text-gray-400\">Name</label>\r\n                        <input\r\n                            id=\"name\"\r\n                            name=\"name\"\r\n                            type=\"text\"\r\n                            value={name}\r\n                            onChange={(e) => setName(e.target.value)}\r\n                            className=\"w-full px-4 py-3 mt-2 text-gray-100 bg-gray-800 border border-gray-700 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none\"\r\n                            placeholder=\"Your name (optional)\"\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label\r\n                            htmlFor=\"password\"\r\n                            className=\"text-sm font-bold text-gray-400\"\r\n                        >\r\n                            Password\r\n                        </label>\r\n                        <input\r\n                            id=\"password\"\r\n                            name=\"password\"\r\n                            type=\"password\"\r\n                            required\r\n                            value={password}\r\n                            onChange={(e) => setPassword(e.target.value)}\r\n                            className=\"w-full px-4 py-3 mt-2 text-gray-100 bg-gray-800 border border-gray-700 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none\"\r\n                            placeholder=\"••••••••\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-center pt-2\">\r\n                        <ReCAPTCHA\r\n                            sitekey={siteKey}\r\n                            onChange={(token) => setRecaptchaToken(token)}\r\n                            theme=\"dark\" // Set the reCAPTCHA theme to dark\r\n                        />\r\n                    </div>\r\n\r\n                    {error && <p className=\"text-sm text-center text-red-400\">{error}</p>}\r\n\r\n                    <div>\r\n                        <button\r\n                            type=\"submit\"\r\n                            className=\"w-full px-4 py-3 font-semibold text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-950 focus:ring-blue-500 transition-colors duration-300\"\r\n                        >\r\n                            Login\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n                <div className=\"text-center\">\r\n                    <Link href=\"/\" className=\"inline-flex items-center gap-2 text-sm text-blue-400 hover:underline\">\r\n                        <ArrowLeft size={16} /> Back to Home\r\n                    </Link>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// We wrap the main component in Suspense because `useSearchParams` needs it.\r\nexport default function LoginPage() {\r\n    return (\r\n        <Suspense fallback={<div className=\"flex items-center justify-center min-h-screen bg-gray-900 text-white\">Loading...</div>}>\r\n            <LoginContent />\r\n        </Suspense>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}